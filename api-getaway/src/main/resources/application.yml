server:
  port: 4004
  # Gateway è¿™ä¸ªæœåŠ¡ï¼Œç›‘å¬æœ¬åœ° 4004 ç«¯å£ã€‚
  # æ‰€ä»¥å½“ä½ è®¿é—® http://localhost:4004ï¼Œå…¶å®å°±æ˜¯è¯·æ±‚åˆ°ä½ çš„ Gatewayã€‚

spring:
  cloud:
    gateway:
      routes:
        - id: auth-service-route
          uri: http://auth-service:4005
          # è¿™ä¸ª route çš„ä½œç”¨æ˜¯ï¼š
          # å¦‚æœè¯·æ±‚åŒ¹é…ä¸‹é¢çš„è§„åˆ™ï¼Œå®ƒä¼šè½¬å‘åˆ°æœåŠ¡ auth-service:4000ã€‚
          # auth-service ğŸ‘‰ æŒ‡ Docker é‡Œçš„æœåŠ¡åï¼Œæˆ–è€… Kubernetes é‡Œçš„æœåŠ¡åã€‚
          # :4000 ğŸ‘‰ é‚£ä¸ªæœåŠ¡ç›‘å¬çš„ç«¯å£æ˜¯ 4000ã€‚

          predicates:
            - Path=/auth/**
            # åªæœ‰å½“è¯·æ±‚è·¯å¾„æ˜¯ /auth/** çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è¿™ä¸ªè·¯ç”±è§„åˆ™ã€‚
            # ä¾‹å¦‚ï¼š
            # http://localhost:4004/auth/login ğŸ‘‰ ä¼šåŒ¹é… âœ”ï¸
            # http://localhost:4004/auth/register ğŸ‘‰ ä¼šåŒ¹é… âœ”ï¸
            # http://localhost:4004/api/patients ğŸ‘‰ ä¸ä¼šåŒ¹é… âŒ

          filters:
            - StripPrefix=1
            # åœ¨è½¬å‘åˆ°åç«¯æœåŠ¡å‰ï¼Œå»æ‰ URL å‰é¢çš„ 1æ®µè·¯å¾„ã€‚
            # ä¾‹å¦‚ï¼šè®¿é—® http://localhost:4004/auth/login
            # Gateway ä¼šè½¬å‘ä¸ºï¼šhttp://auth-service:4000/login
            # âœ”ï¸ è·¯å¾„å‰ç¼€ /auth è¢«è‡ªåŠ¨å»æ‰ï¼ˆstripæ‰1æ®µå‰ç¼€ï¼‰ã€‚

        # REST ğŸ‘‰ http://localhost:4004/api/patients
        # API å®é™…è®¿é—® ğŸ‘‰ http://patient-service:4000/patients
        # å¦‚æœä½ æœ‰å¦ä¸€ä¸ªæœåŠ¡å« patient-serviceï¼Œå¹¶ä¸” Gateway ä¹Ÿç»™å®ƒé…ç½®äº†è·¯ç”±ï¼Œæ¯”å¦‚ï¼š
        - id: patient-service-route
          uri: http://patient-service:4000
          predicates:
            - Path=/api/patients/**
          filters:
            - StripPrefix=1
            - JwtValidation
            # è¿™ä¸ª JwtValidation æ˜¯è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼Œç”¨æ¥åš token éªŒè¯ã€‚

        # é…ç½® Swagger API æ–‡æ¡£çš„è½¬å‘è§„åˆ™
        # è¿™ä¸ªæ˜¯ç»™ patient-service çš„æ¥å£æ–‡æ¡£
        - id: api-docs-patient-route
          uri: http://patient-service:4000
          predicates:
            - Path=/api-docs/patients
          filters:
            - RewritePath=/api-docs/patients,/v3/api-docs
            # å¦‚æœä½ è®¿é—®ï¼š
            # http://localhost:4004/api-docs/patients
            # Gateway ä¼šå¸®ä½ è‡ªåŠ¨è½¬å‘æˆï¼š
            # http://patient-service:4000/v3/api-docs

        # è¿™ä¸ªæ˜¯ç»™ auth-service çš„æ¥å£æ–‡æ¡£
        - id: api-docs-auth-route
          uri: http://auth-service:4005
          predicates:
            - Path=/api-docs/auth
          filters:
            - RewritePath=/api-docs/auth,/v3/api-docs
